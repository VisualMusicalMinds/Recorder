<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recorder Note Player</title>
  <style>

    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: white;
      height: auto;
    }

    img {
      height: 500px;
    }

    .note-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 3px;
    }

    .note-box {
      width: 60px;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      border: 1px solid #aaa;
      border-radius: 5px;
      cursor: pointer;
      color: white;
    }
      .note-box.active {
      transform: scale(1.15);
      transition: transform 0.1s ease;
    }
  </style>
</head>
<body>
  <div style="display: inline-block; padding: 0; margin: 0; box-sizing: content-box;">
    <div style="transform: scale(var(--scale)); transform-origin: top left; display: flex; align-items: center; gap: 20px; flex-shrink: 0;">
  <div id="scaling-wrapper" style="transform-origin: top left; display: flex; align-items: flex-start; gap: 5px;">
  <img id="recorderImage" src="https://https://visualmusicalminds.github.io/images/Recorder%20Pngs0001.png" alt="Recorder" />

  <div class="note-container" id="noteContainer"></div>

  <script>
    const notes = [
      { label: "C", pitch: "C4", color: "#FF0000", image: "https://https://visualmusicalminds.github.io/images/Recorder%20Pngs0002.png" },
      { label: "D", pitch: "D4", color: "#FFA500", image: "https://https://visualmusicalminds.github.io/images/Recorder%20Pngs0003.png" },
      { label: "E", pitch: "E4", color: "#FFFF00", image: "https://https://visualmusicalminds.github.io/images/Recorder%20Pngs0004.png" },
      { label: "F#", pitch: "F#4", color: "#00FF00", image: "https://https://visualmusicalminds.github.io/images/Recorder%20Pngs0006.png" },
      { label: "G", pitch: "G4", color: "#40E0D0", image: "https://https://visualmusicalminds.github.io/images/Recorder%20Pngs0007.png" },
      { label: "A", pitch: "A4", color: "#0000FF", image: "https://https://visualmusicalminds.github.io/images/Recorder%20Pngs0008.png" },
      { label: "B", pitch: "B4", color: "#800080", image: "https://https://visualmusicalminds.github.io/images/Recorder%20Pngs0009.png" },
      { label: "C", pitch: "C5", color: "#FF0000", image: "https://https://visualmusicalminds.github.io/images/Recorder%20Pngs0010.png" },
      { label: "D", pitch: "D5", color: "#FFA500", image: "https://https://visualmusicalminds.github.io/images/Recorder%20Pngs0011.png" },
      { label: "E", pitch: "E5", color: "#FFFF00", image: "https://https://visualmusicalminds.github.io/images/Recorder%20Pngs0012.png" },
    ];

    const noteContainer = document.getElementById("noteContainer");

    notes.forEach((note, index) => {
      const box = document.createElement("div");
      box.className = "note-box";
      box.textContent = note.label;
      box.style.backgroundColor = note.color;
      box.style.color = note.label === "E" ? "#444" : "white";
      box.dataset.pitch = note.pitch;
      box.dataset.index = index;
      noteContainer.prepend(box); // Reversed stacking order
    });

    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();
    const activeOscillators = {};

    function midiToFreq(note) {
      const noteMap = {
        C: 0, Cs: 1, D: 2, Ds: 3, E: 4, F: 5, Fs: 6, G: 7, Gs: 8, A: 9, As: 10, B: 11
      };
      const match = note.match(/^([A-G]#?)(\d)$/);
      if (!match) return 440;
      const [, name, octave] = match;
      const semitone = noteMap[name.replace('#', 's')];
      return 440 * Math.pow(2, (semitone + (octave - 4) * 12 - 9) / 12);
    }

    function startNote(note) {
      if (activeOscillators[note]) return;
      const oscillator = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      oscillator.type = "triangle";
      oscillator.frequency.setValueAtTime(midiToFreq(note), audioCtx.currentTime);
      gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
      oscillator.connect(gain).connect(audioCtx.destination);
      oscillator.start();
      activeOscillators[note] = { oscillator, gain };
    }

    function stopNote(note) {
      const active = activeOscillators[note];
      if (active) {
        active.gain.gain.setTargetAtTime(0.0001, audioCtx.currentTime, 0.2);
        active.oscillator.stop(audioCtx.currentTime + 0.5);
        delete activeOscillators[note];
      }
    }

    document.querySelectorAll('.note-box').forEach(box => {
      box.addEventListener('mousedown', () => {
        startNote(box.dataset.pitch);
        const image = document.getElementById('recorderImage');
        const note = notes.find(n => n.pitch === box.dataset.pitch);
        if (image && note?.image) image.src = note.image;
        box.classList.add('active');
      });
      box.addEventListener('mouseup', () => {
        stopNote(box.dataset.pitch);
        box.classList.remove('active');
      });
      box.addEventListener('mouseleave', () => {
        stopNote(box.dataset.pitch);
        box.classList.remove('active');
      });
      box.addEventListener('touchstart', (e) => {
        e.preventDefault();
        startNote(box.dataset.pitch);
        const image = document.getElementById('recorderImage');
        const note = notes.find(n => n.pitch === box.dataset.pitch);
        if (image && note?.image) image.src = note.image;
        box.classList.add('active');
      }, { passive: false });
      box.addEventListener('touchend', () => {
        stopNote(box.dataset.pitch);
        box.classList.remove('active');
      });
    });

    window.addEventListener('keydown', e => {
      const keyMap = {
        '1': 0, '2': 1, '3': 2, '4': 3, '5': 4,
        '6': 5, '7': 6, '8': 7, '9': 8, '0': 9
      };
      const index = keyMap[e.key];
      if (index !== undefined) {
        const pitch = notes[index].pitch;
        startNote(pitch);
        const image = document.getElementById('recorderImage');
        const note = notes.find(n => n.pitch === pitch);
        if (image && note?.image) image.src = note.image;
        const box = document.querySelector(`.note-box[data-pitch='${pitch}']`);
        if (box) box.classList.add('active');
      }
    });

    window.addEventListener('keyup', e => {
      const keyMap = {
        '1': 0, '2': 1, '3': 2, '4': 3, '5': 4,
        '6': 5, '7': 6, '8': 7, '9': 8, '0': 9
      };
      const index = keyMap[e.key];
      if (index !== undefined) {
        const pitch = notes[index].pitch;
        stopNote(pitch);
        const box = document.querySelector(`.note-box[data-pitch='${pitch}']`);
        if (box) box.classList.remove('active');
      }
    });
  document.body.addEventListener('mousedown', e => {
  if (!e.target.classList.contains('note-box')) {
    const image = document.getElementById('recorderImage');
    image.src = "https://raw.githubusercontent.com/VisualMusicalMinds/Recorder-Images/refs/heads/main/Recorder%20Pngs0001.png";
  }
});

    document.body.addEventListener('touchstart', e => {
      if (!e.target.classList.contains('note-box')) {
        const image = document.getElementById('recorderImage');
        image.src = "https://raw.githubusercontent.com/VisualMusicalMinds/Recorder-Images/refs/heads/main/Recorder%20Pngs0001.png";
      }
    }, { passive: true });
function updateScale() {
  const wrapper = document.getElementById('scaling-wrapper');
  const maxWidth = window.innerWidth;
  const maxHeight = window.innerHeight;
  const contentWidth = 600 + 80;
  const contentHeight = 500;
  const scale = Math.min(maxWidth / 260, maxHeight / 480, 1); // scale to fit 260x480 iframe size
  wrapper.style.transform = `scale(${scale})`;

  // Vertically center the wrapper within the container
  const container = wrapper.parentElement;
  const offsetY = (maxHeight - (contentHeight * scale)) / 2;
  container.style.display = 'block';
  container.style.paddingTop = '0';
  container.style.paddingLeft = '0';
  container.style.margin = '0';
  container.style.overflow = 'hidden';
  container.style.boxSizing = 'border-box';
}

window.addEventListener('resize', updateScale);
window.addEventListener('load', updateScale);

</script>
    </div>
  </div>
</body>
</html>
